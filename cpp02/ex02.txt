
#include "Fixed.hpp"
#include <iostream>
#include <cmath>

Fixed::Fixed() : Bits(0)
{
    std::cout << "Default constructor called" << std::endl;
}

Fixed::Fixed(const Fixed &other) : Bits(other.Bits)
{
    std::cout << "Copy constructor called" << std::endl;
    *this = other;
}

Fixed &Fixed::operator=(const Fixed &other)
{
    std::cout << "Copy assignment operator called" << std::endl;
    if (this != &other)
        this->Bits = other.Bits;
    return *this;
}

Fixed::~Fixed()
{
    std::cout << "Destructor called" << std::endl;
}

Fixed::Fixed(int const number)
{
    std::cout << "Int constructor called" << std::endl;
    Bits = number << f_Bits;
}

Fixed::Fixed(float const value)
{
    std::cout << "Float constructor called" << std::endl;
    Bits = static_cast<int>(roundf(value * (1 << f_Bits)));
}

int Fixed::getRawBits() const
{
    std::cout << "getRawBits member function called" << std::endl;
    return Bits;
}

void Fixed::setRawBits(int const raw)
{
    std::cout << "setRawBits member function called" << std::endl;
    Bits = raw;
}

float Fixed::toFloat() const
{
    return static_cast<float>(Bits) / static_cast<float>(1 << f_Bits);
}

int Fixed::toInt() const
{
    return Bits >> f_Bits;
}

std::ostream &operator<<(std::ostream &out, const Fixed &fixed)
{
    out << fixed.toFloat();
    return out;
}

/*
Implémentation Fixed :
- Constructeurs : défaut, copie, int→fixed (<<), float→fixed (roundf).
- Opérateur = : copie Bits (avec auto-affectation).
- Destructeur : message debug.
- get/setRawBits : accès brut.
- toFloat / toInt : conversions inverses.
- operator<< : affiche en float.
*/


#ifndef FIXED_HPP
#define FIXED_HPP

#include <iostream>

class Fixed
{
private:
    int Bits;
    static const int f_Bits = 8;

public:
    Fixed();
    Fixed(const Fixed &other);
    Fixed &operator=(const Fixed &other);

    ~Fixed();
    Fixed(int const number);
    Fixed(float const value);

    int getRawBits() const;
    void setRawBits(int const raw);
    float toFloat() const;
    int toInt() const;
};

std::ostream &operator<<(std::ostream &out, const Fixed &fixed);

#endif

/*
Classe Fixed :
- Membres : int Bits, static const int f_Bits=8.
- Forme canonique + constructeurs int/float.
- Conversions : toFloat(), toInt().
- Surcharge operator<< pour affichage.
*/


#include <iostream>
#include "Fixed.hpp"

int main(void)
{
    Fixed a;
    Fixed const b(10);
    Fixed const c(42.42f);
    Fixed const d(b);

    a = Fixed(1234.4321f);

    std::cout << "a is " << a << std::endl;
    std::cout << "b is " << b << std::endl;
    std::cout << "c is " << c << std::endl;
    std::cout << "d is " << d << std::endl;

    std::cout << "a is " << a.toInt() << " as integer" << std::endl;
    std::cout << "b is " << b.toInt() << " as integer" << std::endl;
    std::cout << "c is " << c.toInt() << " as integer" << std::endl;
    std::cout << "d is " << d.toInt() << " as integer" << std::endl;
    return 0;
}

/*
Test :
- a : défaut.
- b(10) : int→Fixed.
- c(42.42f) : float→Fixed.
- d(b) : copie.
- a = Fixed(1234.4321f) : affectation d’un temporaire.
- Vérifie affichage (operator<<) et conversion toInt().
*/

GCC     = g++
CFLAGS = -Wall -Wextra -Werror -std=c++98
NAME     = ex01
SRCS     = Fixed.cpp main.cpp
OBJS     = $(SRCS:.cpp=.o)

all: $(NAME)
$(NAME): $(OBJS)
        $(GCC) $(CFLAGS) -o $@ $^

clean:
        rm -f $(OBJS)
fclean: clean
        rm -f $(NAME)
re: fclean all
.PHONY: all clean fclean re
c2r5s3% 