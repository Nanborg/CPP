/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   Aform.cpp                                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/24 13:26:32 by marvin            #+#    #+#             */
/*   Updated: 2025/12/24 13:26:32 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "Aform.hpp"

AForm::AForm(const std::string name, int gradeSign, int gradeExec) 
    : _name(name), _isSigned(false), _gradeSign(gradeSign), _gradeExec(gradeExec)
    {
        if (gradeSign < 1 || gradeExec < 1)
            throw AForm::GradeTooHighException();
        if (gradeSign > 150 || gradeExec > 150)
            throw AForm::GradeTooLowException();
    }

AForm::AForm(const AForm &src)
    : _name(src._name), _isSigned(src._isSigned), _gradeSign(src._gradeSign), _gradeExec(src._gradeExec)
{}

AForm &AForm::operator=(const AForm &other)
{
    if (this != &other)
    {
        this->_isSigned = other._isSigned;
    }
    return *this;
}

AForm::~AForm()
{}

const std::string AForm::getname() const
{
    return _name;
}

bool AForm::isSigned() const
{
    return _isSigned;
}
int AForm::getGradeSign() const
{
    return _gradeSign;
}
int AForm::getgradeExec() const
{
    return _gradeExec;
}
void AForm::beSigned(const Bureaucrat &bureaucrat)
{
    if (bureaucrat.getGrade() > _gradeSign)
        throw AForm::GradeTooLowException();
    _isSigned = true;
}

void AForm::execute(Bureaucrat const & executor) const
{
    if (!_isSigned)
        throw AForm::NotSignedException();
    if (executor.getGrade() > _gradeExec)
        throw AForm::GradeTooLowException();
    this-> execAction();
}

const char *AForm::GradeTooHighException::what() const throw()
{
    return "AForm Exception: Grade too high";
}
const char *AForm::GradeTooLowException::what() const throw()
{
    return "AForm Exception: Grade too low";
}
const char *AForm::NotSignedException::what() const throw()
{
    return "AForm Exception: Form not signed";
}

std::ostream &operator<<(std::ostream &out, const AForm &form)
{
    out << "AForm Name: " << form.getname() << ", Signed: " << (form.isSigned() ? "Yes" : "No")
        << ", Grade Required to Sign: " << form.getGradeSign()
        << ", Grade Required to Execute: " << form.getgradeExec();
    return out;
}

/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   Aform.hpp                                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/24 13:26:29 by marvin            #+#    #+#             */
/*   Updated: 2025/12/24 13:26:29 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#ifndef AFORM_HPP
# define AFORM_HPP

# include <iostream>
# include <string>
# include "Bureaucrat.hpp"

class Bureaucrat;

class AForm
{
    private :
        const std::string _name;
        bool             _isSigned;
        const int       _gradeSign;
        const int       _gradeExec;
        AForm();

    public :
        AForm(const std::string name, int gradeSign, int gradeExec);
        AForm(const AForm &src);
        AForm &operator=(const AForm &other);
        virtual ~AForm();

        const std::string getname() const;
        bool isSigned() const;
        int getGradeSign() const;
        int getgradeExec() const;

        void beSigned(const Bureaucrat &bureaucrat);
        void execute(Bureaucrat const & executor) const;
        virtual void execAction() const = 0;

        class GradeTooHighException : public std::exception
        {
            public:
                virtual const char *what() const throw();
        };
        class GradeTooLowException : public std::exception
        {
            public:
                virtual const char *what() const throw();
        };
        class NotSignedException : public std::exception
        {
            public:
                virtual const char *what() const throw();
        };
};

std::ostream &operator<<(std::ostream &out, const AForm &form);

#endif/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   Bureaucrat.cpp                                     :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/23 00:22:32 by marvin            #+#    #+#             */
/*   Updated: 2025/12/23 00:22:32 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "Bureaucrat.hpp"

Bureaucrat::Bureaucrat() : _name("noname"), _grade(150)
{

}

Bureaucrat::Bureaucrat(const std::string name, int grade) : _name(name)
{
    if (grade < 1)
        throw Bureaucrat::GradeTooHighException();
    if (grade > 150)
        throw Bureaucrat::GradeTooLowException();
    this->_grade = grade;
}

Bureaucrat::Bureaucrat(const Bureaucrat &src) : _name(src._name)
{
    *this = src;
}

Bureaucrat &Bureaucrat::operator=(const Bureaucrat &other)
{
    if (this != &other)
    {
        this->_grade = other._grade;
    }
    return *this;
}

Bureaucrat::~Bureaucrat()
{

}

const std::string Bureaucrat::getName() const
{
    return this->_name;
}

int Bureaucrat::getGrade() const
{
    return this->_grade;
}

void Bureaucrat::incrementGrade()
{
    if (this->_grade - 1 < 1)
        throw Bureaucrat::GradeTooHighException();
    this->_grade--;
}

void Bureaucrat::decrementGrade()
{
    if (this->_grade + 1 > 150)
        throw Bureaucrat::GradeTooLowException();
    this->_grade++;
}

const char *Bureaucrat::GradeTooHighException::what() const throw()
{
    return "Grade is too high! (Max is 1)";
}

const char *Bureaucrat::GradeTooLowException::what() const throw()
{
    return "Grade is too low! (Min is 150)";
}

void Bureaucrat::signForm(Form &form)
{
    try
    {
        form.beSigned(*this);
        std::cout << _name << " signed " << form.getName() << std::endl;
    }
    catch (std::exception &exception)
    {
        std::cerr << _name << " couldn’t sign "
                  << form.getName() << " because "
                  << exception.what() << std::endl;
    }
}

void Bureaucrat::signForm(AForm &form)
{
    try
    {
        form.beSigned(*this);
        std::cout << _name << " signed " << form.getname() << std::endl;
    }
    catch (std::exception &exception)
    {
        std::cerr << _name << " couldn’t sign "
                  << form.getname() << " because "
                  << exception.what() << std::endl;
    }
}

void Bureaucrat::executeForm(AForm const &form) const
{
    try
    {
        form.execute(*this);
        std::cout << _name << " executed " << form.getname() << std::endl;
    }
    catch(std::exception &execute)
    {
        std::cout << _name << " couldn't execute " << form.getname() << " because " << execute.what() << std::endl;
    }
    
}

std::ostream &operator<<(std::ostream &out, const Bureaucrat &other)
{
    out << other.getName() << ", bureaucrat grade " << other.getGrade() << ".";
    return out;
}

/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   Bureaucrat.hpp                                     :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/23 00:21:55 by marvin            #+#    #+#             */
/*   Updated: 2025/12/23 00:21:55 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#ifndef BUREAUCRAT_HPP
# define BUREAUCRAT_HPP

# include <iostream>
# include <string>
# include <exception>
#include "Form.hpp"
#include "AForm.hpp"


class Form;
class AForm;
class Bureaucrat
{
    private:
        const std::string   _name;
        int                 _grade;
        Bureaucrat();

    public:
        Bureaucrat(const std::string name, int grade);
        Bureaucrat(const Bureaucrat &src);
        Bureaucrat &operator=(const Bureaucrat &other);
        ~Bureaucrat();

        const std::string   getName() const;
        int                 getGrade() const;
        void                incrementGrade();
        void                decrementGrade();
        void                signForm(Form &form);
        void                signForm(AForm &form);
        void                executeForm(AForm const &form) const;

        class GradeTooHighException : public std::exception
        {
            public:
                virtual const char *what() const throw();
        };

        class GradeTooLowException : public std::exception
        {
            public:
                virtual const char *what() const throw();
        };
        
};

std::ostream &operator<<(std::ostream &out, const Bureaucrat &other);
#endif/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   form.cpp                                           :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/23 11:07:30 by marvin            #+#    #+#             */
/*   Updated: 2025/12/23 11:07:30 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "Form.hpp"

Form::Form(const std::string name, int gradeSign, int gradeExecute) : _name(name), _isSigned(false), _gradeSign(gradeSign), _gradeExecute(gradeExecute) 
{
    if (_gradeSign < 1 || _gradeExecute < 1)
        throw Form::GradeTooHighException();
    if (_gradeSign > 150 || _gradeExecute > 150)
        throw Form::GradeTooLowException();
}

Form::Form(const Form &src) : _name(src._name), _isSigned(src._isSigned), _gradeSign(src._gradeSign), _gradeExecute(src._gradeExecute)
{

}

Form &Form::operator=(const Form &other)
{
    if (this != &other)
    {
        this->_isSigned = other._isSigned;
    }
    return *this;
}

Form::~Form() {}

const std::string Form::getName() const 
{
    return _name;
}
bool Form::getSigned() const
{
    return _isSigned;
}

int Form::getGradeSign() const
{
    return _gradeSign;
}

int Form::getGradeExecute() const
{
    return _gradeExecute;
}

void Form::beSigned(const Bureaucrat &Bureaucrat)
{
    if (Bureaucrat.getGrade() > _gradeSign)
        throw Form::GradeTooLowException();
    _isSigned = true;
}

const char *Form::GradeTooHighException::what() const throw()
{
    return "Form grade is too high!";
}

const char *Form::GradeTooLowException::what() const throw()
{
    return "Form grade is too Low!";
}

std::ostream &operator<<(std::ostream &out, const Form &form)
{
    out << "Form " << form.getName()
        << ", signed: " << (form.getSigned() ? "yes" : "no")
        << ", sign grade: " << form.getGradeSign()
        << ", exec grade: " << form.getGradeExecute();
    return out;
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   form.hpp                                           :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/23 11:07:44 by marvin            #+#    #+#             */
/*   Updated: 2025/12/23 11:07:44 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#ifndef FORM_HPP
#define FORM_HPP

#include <iostream>
#include <string>
#include <exception>
#include "Bureaucrat.hpp"

class Bureaucrat;
class Form
{
    private:
        const std::string  _name;
        bool                _isSigned;
        const int          _gradeSign;
        const int          _gradeExecute;
        Form();

    public:
        Form(const std::string name, int gradeSign, int gradeExecute);
        Form(const Form &src);
        Form &operator=(const Form &other);
        ~Form();

        const std::string getName() const;
        bool              getSigned() const;
        int              getGradeSign() const;
        int              getGradeExecute() const;

        void           beSigned(const Bureaucrat &bureaucrat);

        class GradeTooHighException : public std::exception
        {
            public:
                virtual const char *what() const throw();
        };
        class GradeTooLowException : public std::exception
        {
            public:
                virtual const char *what() const throw();
        };
};

std::ostream &operator<<(std::ostream &out, const Form &form);

#endifNAME = ex02
CXX = c++
CXXFLAGS = -Wall -Werror -Wextra -std=c++98

SRCS = main.cpp Bureaucrat.cpp Form.cpp Aform.cpp ShrubberyCreationForm.cpp RobotomyRequestForm.cpp PresidentialPardonForm.cpp
OBJS = $(SRCS:.cpp=.o)
HEADERS = Bureaucrat.hpp Form.hpp Aform.hpp ShrubberyCreationForm.hpp RobotomyRequestForm.hpp PresidentialPardonForm.hpp

all: $(NAME)

$(OBJS): $(HEADERS)

$(NAME): $(OBJS)
	$(CXX) $(CXXFLAGS) -o $(NAME) $(OBJS)

clean:
	rm -f $(OBJS)

fclean: clean
	rm -f $(NAME)

re: fclean all

.PHONY: all clean fclean re



/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   PresidentialPardonForm.cpp                         :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/24 15:27:17 by marvin            #+#    #+#             */
/*   Updated: 2025/12/24 15:27:17 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "PresidentialPardonForm.hpp"

PresidentialPardonForm::PresidentialPardonForm(std::string target) : AForm("PresidentialPardonForm", 25, 5), _target(target) {}

PresidentialPardonForm::PresidentialPardonForm(const PresidentialPardonForm &src) : AForm(src), _target(src._target) {}

PresidentialPardonForm &PresidentialPardonForm::operator=(const PresidentialPardonForm &other)
{
    if (this != &other)
    {
        AForm::operator=(other);
        _target = other._target;
    }
    return *this;
}

PresidentialPardonForm::~PresidentialPardonForm() {}

void PresidentialPardonForm::execAction() const 
{
    std::cout << _target << " has been pardoned by Zaphod Beeblebrox" << std::endl;
}/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   PresidentialPardonForm.hpp                         :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/24 15:27:20 by marvin            #+#    #+#             */
/*   Updated: 2025/12/24 15:27:20 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#ifndef PRESIDENTIALPARDONFORM_HPP
#define PRESIDENTIALPARDONFORM_HPP

#include "Aform.hpp"

class PresidentialPardonForm : public AForm
{
    private:
        std::string _target;
        PresidentialPardonForm();
    public:
        PresidentialPardonForm(std::string target);
        PresidentialPardonForm(const PresidentialPardonForm &src);
        PresidentialPardonForm &operator=(const PresidentialPardonForm &other);
        ~PresidentialPardonForm();


    void execAction() const;
};

#endif
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   RobotomyRequestForm.cpp                            :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/24 15:26:51 by marvin            #+#    #+#             */
/*   Updated: 2025/12/24 15:26:51 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "RobotomyRequestForm.hpp"
#include <ctime>
#include <cstdlib>

RobotomyRequestForm::RobotomyRequestForm(std::string target) : AForm("RobotomyRequestForm", 72, 45), _target(target) {}

RobotomyRequestForm::RobotomyRequestForm(const RobotomyRequestForm &src) : AForm(src), _target(src._target) {}

RobotomyRequestForm &RobotomyRequestForm::operator=(const RobotomyRequestForm &other)
{
    if (this != &other)
    {
        AForm::operator=(other);
        _target = other._target;
    }
    return *this;
}

RobotomyRequestForm::~RobotomyRequestForm() {}

void RobotomyRequestForm::execAction() const
{
    std::cout << "* BZZZZZ... DRILLING NOISES *" << std::endl;
    if (std::rand() % 2)
        std::cout << _target << " has been robomized successfully!" << std::endl;
    else
        std::cout << "Robotomization of " << _target << " failed" << std::endl;
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   RobotomyRequestForm.hpp                            :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/24 15:25:57 by marvin            #+#    #+#             */
/*   Updated: 2025/12/24 15:25:57 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#ifndef ROBOTOMYREQUESTFORM_HPP
# define ROBOTOMYREQUESTFORM_HPP


#include "Aform.hpp"
#include <cstdlib>

class RobotomyRequestForm : public AForm 
{
    private:
        std::string _target;
        RobotomyRequestForm();
    public:
        RobotomyRequestForm(std::string target);
        RobotomyRequestForm(const RobotomyRequestForm &src);
        RobotomyRequestForm &operator=(const RobotomyRequestForm &other);
        ~RobotomyRequestForm();

        void execAction() const;
};

#endif/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ShrubberyCreationForm.cpp                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/24 13:55:50 by marvin            #+#    #+#             */
/*   Updated: 2025/12/24 13:55:50 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "ShrubberyCreationForm.hpp"

ShrubberyCreationForm::ShrubberyCreationForm(std::string target) 
    : AForm("ShrubberyCreationForm", 145, 137), _target(target) {}

ShrubberyCreationForm::ShrubberyCreationForm(const ShrubberyCreationForm &src) 
    : AForm(src), _target(src._target) {}

ShrubberyCreationForm &ShrubberyCreationForm::operator=(const ShrubberyCreationForm &other) {
    if (this != &other) {
        AForm::operator=(other);
        _target = other._target;
    }
    return *this;
}

ShrubberyCreationForm::~ShrubberyCreationForm() {}

void ShrubberyCreationForm::execAction() const {
    std::string filename = _target + "_shrubbery";
    std::ofstream ofs(filename.c_str());
    if (ofs.is_open()) 
    {
        ofs << "                          XXX                            \n";
        ofs << "                          XXX                            \n";
        ofs << "                          XXX                            \n";
        ofs << "                          XXX                            \n";
        ofs << "                XXXXXXXXXXXXXXXXXXXXXXX                  \n";
		ofs << "                         XXXXX                           \n";
        ofs << "                        XXXXXXX                          \n";
		ofs << "                      XX  XXX  XX                        \n";
		ofs << "                  XXX     XXX    XXX                     \n";
		ofs << "              XXXXX       XXX      XXXXX                 \n";
		ofs << "                          XXX                            \n";
		ofs << "              XXX         XXX         XXX                \n";
		ofs << "              XXX                     XXX                \n";
		ofs << "              XXX                     XXX                \n";
		ofs << "     XXXXXXXXXXXXXXXXXXXXX    XXXXXXXXXXXXXXXXXXXX       \n";
		ofs << "             XXXXX                   XXXXX               \n";
		ofs << "            XXXXXXX                 XXXXXXX              \n";
		ofs << "           XX XXX XX               XX XXX XX             \n";
		ofs << "         XX   XXX   XX           XX   XXX   XX           \n";
		ofs << "       XX     XXX              XX     XXX     XX         \n";
		ofs << "     XX       XXX            XX       XXX       XX       \n";
		ofs << "              XXX                     XXX                \n";
		ofs << "                                                         \n";
        ofs.close();
    }
}
/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ShrubberyCreationForm.hpp                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/24 13:48:14 by marvin            #+#    #+#             */
/*   Updated: 2025/12/24 13:48:14 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#ifndef SHRUBBERYCREATIONFORM_HPP
#define SHRUBBERYCREATIONFORM_HPP

#include "AForm.hpp"
#include <fstream>

class ShrubberyCreationForm : public AForm 
{
    private:
        std::string _target;
        ShrubberyCreationForm();
    public:
    
        ShrubberyCreationForm(std::string target);
        ShrubberyCreationForm(const ShrubberyCreationForm &src);
        ShrubberyCreationForm &operator=(const ShrubberyCreationForm &other);
        ~ShrubberyCreationForm();

        void execAction() const;
};


#endif/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   main.c                                             :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: marvin <marvin@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/12/23 11:10:34 by marvin            #+#    #+#             */
/*   Updated: 2025/12/23 11:10:34 by marvin           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "Bureaucrat.hpp"
#include "ShrubberyCreationForm.hpp"
#include "RobotomyRequestForm.hpp"
#include "PresidentialPardonForm.hpp"
#include <ctime>
#include <cstdlib>


int main()
{
    std::srand(std::time(NULL));

    try
    {
        Bureaucrat Stalin("Stalin", 1);
        Bureaucrat Kroutchev("Kroutchev", 150);

        ShrubberyCreationForm f1("Goulag");
        RobotomyRequestForm f2("Coupon");
        PresidentialPardonForm f3("Capitalist");
        std::cout << "signatures" << std::endl;
        Stalin.signForm(f1);
        Stalin.signForm(f2);
        Stalin.signForm(f3);

        std::cout << "executions" << std::endl;
        Stalin.executeForm(f1);
        Stalin.executeForm(f2);
        Stalin.executeForm(f3);

        std::cout << "\ntry with low level bureaucrat\n" << std::endl;
        Kroutchev.signForm(f1);
        Kroutchev.executeForm(f1);
    }
    catch(const std::exception& exception)
    {
        std::cerr << "fail" << exception.what() << std::endl;
    }
    
    return 0;
}